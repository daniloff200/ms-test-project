# Ms-test-project

## Table of contents

* [Introduction](#introduction)
* [What do you need](#what-do-you-need)
* [Register the application](#register-the-application)
* [Build and run this app](#build-and-run-this-app)
* [How to get token?](#how-to-get-token)
* [How to get users](#how-to-get-users)
* [Additional resources](#additional-resources)

## Introduction

This sample shows how to connect an Angular app to a Microsoft work or school (Azure Active Directory) or personal (Microsoft) account.
This sample uses [HelloJS](https://adodson.com/hello.js/) to get an access token.

## What do you need

To use this sample, you need the following:
* [Node.js](https://nodejs.org/). Node is required to run the sample on a development server and to install dependencies. 
* [Angular CLI](https://github.com/angular/angular-cli)
* Either a [Microsoft account](https://www.outlook.com) or [Office 365 for business account](https://msdn.microsoft.com/en-us/office/office365/howto/setup-development-environment#bk_Office365Account)

## Register the application

1. Sign into the [App Registration Portal](https://apps.dev.microsoft.com/) using either your personal or work or school account.

2. Choose **Add an app**.

3. Enter a name for the app, and choose **Create application**. 
	
   The registration page displays, listing the properties of your app.

4. Copy the Application Id. This is the unique identifier for your app. 

5. Under **Platforms**, choose **Add Platform**.

6. Choose **Web**.

7. Make sure the **Allow Implicit Flow** check box is selected, and enter *http://localhost:4200/* as the Redirect URI. 

8. Choose **Save**.


## Build and run this app

1. Using your favorite IDE, open **configs.ts** in *src/app/shared*.

2. Replace the **ENTER_YOUR_CLIENT_ID** placeholder value with the application ID of your registered Azure application.

3. In a command prompt, run the following command in the root directory: `npm install`. This installs project dependencies, including the [HelloJS](http://adodson.com/hello.js/) client-side authentication library and the [Microsoft Graph JavaScript SDK](https://github.com/microsoftgraph/msgraph-sdk-javascript).
  
4. Run `npm start` to start the development server.

5. Navigate to [http://localhost:4200/](http://localhost:4200/) in your web browser.

6. Press the **Connect** button.


## How to get token?
The first step in the authorization code flow is to get an authorization code. That code is returned to the app by Azure when the user logs on and consents to the level of access the app requires.

First the app constructs a logon URL for the user. This URL must be opened in a browser so that the user can login and provide consent.

The base URL for logon looks like:
 
```https://login.microsoftonline.com/common/oauth2/v2.0/authorize```

The app appends query parameters to this base URL to let Azure know what app is requesting the logon, and what permissions it is requesting.

* *client_id*: the client ID generated by registering the app. This lets Azure know which app is requesting the logon.
* *redirect_uri*: the location that Azure will redirect to once the user has granted consent to the app. This value must correspond to the value of Redirect URI used when registering the app.
* *response_type*: the type of response the app is expecting. For the Authorization Grant Flow, this should always be code.
* *scope*: a space-delimited list of access scopes that your app requires. For a full list of Outlook scopes in the Microsoft Graph, see [Microsoft Graph permission scopes](https://developer.microsoft.com/en-us/graph/docs/authorization/permission_scopes).

And it will like following:

```GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=<CLIENT ID>&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F&response_type=code&scope=openid+Mail.Read```

Now, we want to get token.To get an access token, the app posts form-encoded parameters to the token request URL, which is always:
                           
```https://login.microsoftonline.com/common/oauth2/v2.0/token```

The app includes the following parameters.

* *client_id*: the client ID generated by registering the app.
* *client_secret*: the client secret generated by registering the app.
* *code*: the authorization code which we get previously
* *redirect_uri*: this value must be the same as the value used in the authorization code request.
* *grant_type*: the type of grant the app is using. For the Authorization Grant Flow, this should always be *authorization_code*.

## How to get users
To get all users list you should use  [this endpoint](https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api/user_list)

*WARNING*: Make sure that user has permissions to get user personal data. You can setup this in GSuite Admin Console for some specific user

In order to get users list:

call `GET https://graph.microsoft.com/v1.0/users/`

## How to get events

*For current user*

To get all events for current user, or, other users [this endpoint](https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api/calendar_list_events)

In order to get events for current user:

call `GET https://graph.microsoft.com/v1.0/me/calendar/events`
  
*For other users (requires admin permissions)*

`GET /users/{id | userPrincipalName}/calendar/events`

## Additional resources

- [Graph explorer sandbox](https://developer.microsoft.com/en-us/graph/graph-explorer)
- [Microsoft Graph API](https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api)
- [Oauth2 Get Started](https://docs.microsoft.com/en-us/outlook/rest/get-started)

